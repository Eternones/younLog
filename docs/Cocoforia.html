<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YoungLog</title>
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <div id="Header"><span class="title-head">연곤 로그 백업 변환기</span>
        <span class="title-desc">V 1.0.0</span>
    </div>
    <div id="nevigation">
        <ul>
            <li><a href="Roll20.html">Roll20</a></li>
            <li><a href="index.html">Info</a></li>
            <li><a href="Cocoforia.html">Cocoforia</a></li>
        </ul>
    </div>
    <div id="content">

        <div>
            <div>
                <p class="content-head">로그 링크</p>
                <input id="url" placeholder="링크">
                <input type="button" id="load" value="입력">
            </div>
            <div>
                <p class="content-head">시스템 캐릭터 지정</p>
                <input id="url" placeholder="시스템 캐릭터">
                <input type="button" id="" value="입력">
            </div>
            <div>
                <p class="content-head">출력 탭 지정</p>
                <input type="checkbox" name="option" vaule="darkMode">메인<br>
                <input type="checkbox" name="option" vaule="deleteItalic">정보<br>
                <input type="checkbox" name="option" vaule="deleteItalic">잡담<br>
            </div>
            <div>
                <p class="content-head">옵션</p>
                <input type="checkbox" name="option" vaule="darkMode">롤20 스타일링<br>
                <input type="checkbox" name="option" vaule="deleteItalic">시스템 기울임꼴 삭제<br>
            </div>
        </div>
        <div>
            <div>
                <div id="log"></div>
            </div>
        </div>
    </div>
    <div id="footer">
        <p>made by @Youngonest_</p>
    </div>
</body>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const PROXY_SERVER = "https://본인의-서비스-이름.onrender.com";
        const statusEl = document.getElementById('status');

        statusEl.innerText = "서버를 깨우는 중입니다. 잠시만 기다려 주세요...";

        // 서버의 루트(/)나 특정 헬스체크 경로에 요청을 보냄
        fetch(`${PROXY_SERVER}/`)
            .then(() => {
                statusEl.innerText = "서버가 준비되었습니다! URL을 입력해주세요.";
                console.log("Server is awake!");
            })
            .catch(() => {
                // 처음엔 서버가 잠들어 있어 에러가 날 수 있지만, 요청 자체로 잠은 깹니다.
                console.log("Server is waking up...");
            });
        async function loadCocofoliaLogs() {
            const urlInput = document.getElementById('roomUrl').value;
            const roomId = urlInput.split('/').pop();

            // 1. Render에서 받은 본인의 서버 주소로 변경하세요.
            const PROXY_SERVER = "https://본인의-서비스-이름.onrender.com";

            const statusEl = document.getElementById('status');
            const contentEl = document.getElementById('content');

            statusEl.innerText = "서버에서 로그를 가져오는 중...";

            try {
                // 2. 내 중계 서버 호출
                const response = await fetch(`${PROXY_SERVER}/proxy/${roomId}`);
                const result = await response.json();

                if (result.error) throw new Error(result.error);

                // 3. 데이터 렌더링 (코코포리아 API 구조에 맞춤)
                const messages = result.data.messages;
                contentEl.innerHTML = "";

                messages.forEach(msg => {
                    const div = document.createElement('div');
                    div.className = 'msg-card';
                    div.innerHTML = `
                <div class="avatar">${msg.name ? msg.name[0] : '?'}</div>
                <div class="msg-content">
                    <div class="msg-header"><strong>${msg.name}</strong></div>
                    <div class="text">${msg.body.replace(/\n/g, '<br>')}</div>
                </div>
            `;
                    contentEl.appendChild(div);
                });

                statusEl.innerText = `${messages.length}개의 로그를 성공적으로 가져왔습니다.`;

            } catch (error) {
                statusEl.innerText = "오류: " + error.message;
                console.error(error);
            }
        }
    });    
</script>

</html>