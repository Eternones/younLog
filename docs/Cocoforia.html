<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YoungLog</title>
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <div id="Header"><span class="title-head">ì—°ê³¤ ë¡œê·¸ ë°±ì—… ë³€í™˜ê¸°</span>
        <span class="title-desc">V 1.0.0</span>
    </div>
    <div id="nevigation">
        <ul>
            <li><a href="Roll20.html">Roll20</a></li>
            <li><a href="index.html">Info</a></li>
            <li><a href="Cocoforia.html">Cocoforia</a></li>
        </ul>
    </div>

    <div id="content">
        <div>
            <div>
                <p class="content-head">ë¡œê·¸ ë§í¬</p>
                <input id="roomUrl" placeholder="https://ccfolia.com/rooms/...">
                <button id="fetchBtn" onclick="loadCocofoliaLogs()">ë°±ì—…</button>
            </div>
            <div>
                <p class="content-head">ì‹œìŠ¤í…œ ìºë¦­í„° ì§€ì •</p>
                <input id="url" placeholder="ì‹œìŠ¤í…œ ìºë¦­í„°">
                <input type="button" id="" value="ì…ë ¥">
            </div>
            <div>
                <p class="content-head">ì¶œë ¥ íƒ­ ì§€ì •</p>
                <input type="checkbox" name="option" vaule="darkMode">ë©”ì¸<br>
                <input type="checkbox" name="option" vaule="deleteItalic">ì •ë³´<br>
                <input type="checkbox" name="option" vaule="deleteItalic">ì¡ë‹´<br>
            </div>
            <div>
                <p class="content-head">ì˜µì…˜</p>
                <input type="checkbox" name="option" vaule="darkMode">ë¡¤20 ìŠ¤íƒ€ì¼ë§<br>
                <input type="checkbox" name="option" vaule="deleteItalic">ì‹œìŠ¤í…œ ê¸°ìš¸ì„ê¼´ ì‚­ì œ<br>
            </div>
        </div>
        <div>
            <div>
                <div id="log"></div>
            </div>
        </div>
    </div>

        <div id="status" style="text-align: center; background: #222; color: #eee; padding: 5px; font-size: 0.9rem;">
        ğŸŸ¡ ì„œë²„ í™•ì¸ ì¤‘...
    </div>

    <div id="footer">
        <p>made by @Youngonest_</p>
    </div>
</body>

<script>
    // 1. ë³¸ì¸ì˜ Render ì„œë²„ ì£¼ì†Œë¡œ ê¼­ ìˆ˜ì •í•˜ì„¸ìš”!
    const PROXY_SERVER = "https://younLog-1.onrender.com";

    const statusEl = document.getElementById('status');
    const fetchBtn = document.getElementById('fetchBtn');

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ ê¹¨ìš°ê¸° (Warm-up)
    window.addEventListener('DOMContentLoaded', async () => {
        statusEl.innerHTML = "ğŸŸ¡ ì„œë²„ ìƒíƒœ í™•ì¸ ì¤‘...";
        fetchBtn.disabled = true;

        try {
            // ì„œë²„ì— ê°€ë²¼ìš´ ìš”ì²­ì„ ë³´ëƒ„
            const start = Date.now();
            await fetch(`${PROXY_SERVER}/proxy/test`); // ì¡´ì¬í•˜ì§€ ì•ŠëŠ” IDë¼ë„ ìš”ì²­ ìì²´ê°€ ì„œë²„ë¥¼ ê¹¨ì›€

            statusEl.innerHTML = "ğŸŸ¢ ì„œë²„ ì˜¨ë¼ì¸ (ì¤€ë¹„ ì™„ë£Œ)";
            fetchBtn.disabled = false;
        } catch (e) {
            // ì„œë²„ê°€ ì ë“¤ì–´ ìˆìœ¼ë©´ ì‘ë‹µì— ì‹œê°„ì´ ê±¸ë¦½ë‹ˆë‹¤.
            statusEl.innerHTML = "â³ ì„œë²„ê°€ ì ë“¤ì–´ ìˆìŠµë‹ˆë‹¤. ê¹¨ìš°ëŠ” ì¤‘... (ìµœëŒ€ 1ë¶„ ì†Œìš”)";

            // 5ì´ˆë§ˆë‹¤ ì¬ì‹œë„í•˜ëŠ” ë¡œì§
            const retry = setInterval(async () => {
                try {
                    await fetch(`${PROXY_SERVER}/proxy/test`);
                    statusEl.innerHTML = "ğŸŸ¢ ì„œë²„ê°€ ë°©ê¸ˆ ê¹¨ì–´ë‚¬ìŠµë‹ˆë‹¤!";
                    fetchBtn.disabled = false;
                    clearInterval(retry);
                } catch (err) { console.log("Waking up..."); }
            }, 5000);
        }
    });

    async function loadCocofoliaLogs() {
        const urlInput = document.getElementById('roomUrl').value;
        const roomId = urlInput.split('/').pop();

        if (!roomId) return alert("URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        statusEl.innerText = "ğŸš€ ë¡œê·¸ ì¶”ì¶œ ì¤‘...";

        try {
            const response = await fetch(`${PROXY_SERVER}/proxy/${roomId}`);
            const result = await response.json();

            if (result.error) throw new Error(result.error);

            renderLogs(result.data.messages);
            statusEl.innerText = `âœ… ${result.data.messages.length}ê°œì˜ ë¡œê·¸ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`;
        } catch (error) {
            statusEl.innerText = "âŒ ì˜¤ë¥˜: " + error.message;
        }
    }

    function renderLogs(messages) {
        const contentEl = document.getElementById('content');
        contentEl.innerHTML = "";
        messages.forEach(msg => {
            const div = document.createElement('div');
            div.className = 'msg-card';
            div.innerHTML = `
            <div class="avatar" style="background:#444; color:white; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:10px;">
                ${msg.name ? msg.name[0] : '?'}
            </div>
            <div>
                <strong>${msg.name}</strong><br>
                <span>${msg.body.replace(/\n/g, '<br>')}</span>
            </div>
        `;
            div.style.display = "flex";
            div.style.marginBottom = "15px";
            contentEl.appendChild(div);
        });
    }
    /* window.addEventListener('DOMContentLoaded', () => {
        const PROXY_SERVER = "https://ë³¸ì¸ì˜-ì„œë¹„ìŠ¤-ì´ë¦„.onrender.com";
        const statusEl = document.getElementById('status');

        statusEl.innerText = "ì„œë²„ë¥¼ ê¹¨ìš°ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...";

        // ì„œë²„ì˜ ë£¨íŠ¸(/)ë‚˜ íŠ¹ì • í—¬ìŠ¤ì²´í¬ ê²½ë¡œì— ìš”ì²­ì„ ë³´ëƒ„
        fetch(`${PROXY_SERVER}/`)
            .then(() => {
                statusEl.innerText = "ì„œë²„ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤! URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                console.log("Server is awake!");
            })
            .catch(() => {
                // ì²˜ìŒì—” ì„œë²„ê°€ ì ë“¤ì–´ ìˆì–´ ì—ëŸ¬ê°€ ë‚  ìˆ˜ ìˆì§€ë§Œ, ìš”ì²­ ìì²´ë¡œ ì ì€ ê¹¹ë‹ˆë‹¤.
                console.log("Server is waking up...");
            });
        async function loadCocofoliaLogs() {
            const urlInput = document.getElementById('roomUrl').value;
            const roomId = urlInput.split('/').pop();

            // 1. Renderì—ì„œ ë°›ì€ ë³¸ì¸ì˜ ì„œë²„ ì£¼ì†Œë¡œ ë³€ê²½í•˜ì„¸ìš”.
            const PROXY_SERVER = "https://ë³¸ì¸ì˜-ì„œë¹„ìŠ¤-ì´ë¦„.onrender.com";

            const statusEl = document.getElementById('status');
            const contentEl = document.getElementById('content');

            statusEl.innerText = "ì„œë²„ì—ì„œ ë¡œê·¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...";

            try {
                // 2. ë‚´ ì¤‘ê³„ ì„œë²„ í˜¸ì¶œ
                const response = await fetch(`${PROXY_SERVER}/proxy/${roomId}`);
                const result = await response.json();

                if (result.error) throw new Error(result.error);

                // 3. ë°ì´í„° ë Œë”ë§ (ì½”ì½”í¬ë¦¬ì•„ API êµ¬ì¡°ì— ë§ì¶¤)
                const messages = result.data.messages;
                contentEl.innerHTML = "";

                messages.forEach(msg => {
                    const div = document.createElement('div');
                    div.className = 'msg-card';
                    div.innerHTML = `
                <div class="avatar">${msg.name ? msg.name[0] : '?'}</div>
                <div class="msg-content">
                    <div class="msg-header"><strong>${msg.name}</strong></div>
                    <div class="text">${msg.body.replace(/\n/g, '<br>')}</div>
                </div>
            `;
                    contentEl.appendChild(div);
                });

                statusEl.innerText = `${messages.length}ê°œì˜ ë¡œê·¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`;

            } catch (error) {
                statusEl.innerText = "ì˜¤ë¥˜: " + error.message;
                console.error(error);
            }
        }
    });    */
</script>

</html>